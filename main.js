mapboxgl.accessToken="pk.eyJ1Ijoiam9yam9uZTkwIiwiYSI6ImNtZDY5ZDZqbDA5MHUya3F2emJncXk0eXgifQ.U-XZt6e_Z-LeVuWx3hut_A";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/jorjone90/cmd1cg82i000101s61qwaca16",center:[44.812,41.741787],zoom:12,maxZoom:20,attributionControl:!1,preserveDrawingBuffer:!0});map.addControl(new mapboxgl.NavigationControl),map.addControl(new mapboxgl.ScaleControl);const flyButtons=document.querySelectorAll(".fly-button");flyButtons.forEach((e=>{e.addEventListener("click",(()=>{flyButtons.forEach((e=>e.classList.remove("selected"))),e.classList.add("selected")}))}));var marker,dataSourceSelect=document.getElementById("data_source");function generateIsochrone(e){var t=document.querySelector('input[name="profile"]:checked').value,n=document.getElementById("contours_minutes").value,o="https://api.mapbox.com/isochrone/v1/mapbox/"+t+"/"+e.lng+","+e.lat+"?contours_minutes="+n+"&polygons=true&denoise=0.1&generalize=10&access_token="+mapboxgl.accessToken;fetch(o).then((function(e){return e.json()})).then((function(e){map.getSource("isochrone").setData(e),map.getSource("isochrone").setData(e);var o=turf.bbox(e);map.fitBounds(o,{bearing:0,pitch:52,maxZoom:22,minZoom:17}),map.once("idle",(function(){fetch("https://raw.githubusercontent.com/axis-Z/urbanyxv1/main/data/elections_2024.geojson").then((function(e){return e.json()})).then((function(t){var n={type:"FeatureCollection",features:t.features.filter((function(t){return turf.booleanPointInPolygon(turf.point(t.geometry.coordinates),e.features[0])}))},o=n.features.reduce((function(e,t){return e+t.properties.total_re_1}),0),r=n.features.reduce((function(e,t){return e+t.properties.total_re_2}),0),s=r+o,l=(o/s*100).toFixed(1),i=(r/s*100).toFixed(1);if("voters"===a){var c=n.features.reduce((function(e,t){return e+t.properties.QOC_VOTES}),0),u=n.features.reduce((function(e,t){return e+t.properties.KOAL_VOTES}),0),p=n.features.reduce((function(e,t){return e+t.properties.KOAL_2_LEL}),0),d=n.features.reduce((function(e,t){return e+t.properties.UNM_VOTES}),0),f=n.features.reduce((function(e,t){return e+t.properties.UNM_2_LEL}),0),g=n.features.reduce((function(e,t){return e+t.properties.LELO_VOTES}),0),m=n.features.reduce((function(e,t){return e+t.properties.LELO_2_LEL}),0),h=n.features.reduce((function(e,t){return e+t.properties.GAKH_VOTES}),0),y=n.features.reduce((function(e,t){return e+t.properties.GAKH_2_GAk}),0),x=n.features.reduce((function(e,t){return e+t.properties.GIRC_VOTES}),0),b=n.features.reduce((function(e,t){return e+t.properties.OTH_VOTES}),0),v={qocebi41:c,koalicia4:u,lelo9:g,gakharia25:h,unm5:d,girchi36:x,otherparties:b};var k=(c/s*100).toFixed(1),L=(u/s*100).toFixed(1),w=(d/s*100).toFixed(1),C=(g/s*100).toFixed(1),E=(h/s*100).toFixed(1),_=(x/s*100).toFixed(1),I=(b/s*100).toFixed(1),S=m+f+p,z=(S/s*100).toFixed(1),F=((z-C)/C*100).toFixed(1),T="",Z="";F>0?(T="🔼",Z="green"):F<0?(T="🔽",Z="red"):(T="",Z="gray");var M=(y/s*100).toFixed(1),B=((M-E)/E*100).toFixed(1),O="",j="";B>0?(O="🔼",j="green"):B<0?(O="🔽",j="red"):(O="",j="gray"),A(s,o,r,l,i,c,u,d,g,h,x,b,k,L,w,C,E,_,I)}else A(s,o,r,l,i);function A(e,t,n,o,r,a=null,s=null,l=null,i=null,c=null,u=null,p=null,d=null,f=null,g=null,m=null,h=null,x=null,b=null){var k=document.getElementById("pielegend"),L=document.getElementById("legend");k.innerHTML="<div id='genderPieChart'><p class='piecharttitle'><strong><span class='innerhtml'> ამომრჩევლები <br></strong></span><span class='innerhtml' style='color:#969696; font-size: 22px;'>"+e+"</span></p></div>";var w,C=parseFloat(function(e){var t=Object.values(e),n=t.reduce(((e,t)=>e+t),0);if(0===n)return 0;var o=0;return t.forEach((function(e){if(e>0){var t=e/n;o-=t*Math.log2(t)}})),o.toFixed(3)}(v)),E=(w=C)>=2.5?{label:"მაღალი",backgroundColor:"green",fontColor:"white"}:w>=2?{label:"საშუალო",backgroundColor:"orange",fontColor:"white"}:{label:"დაბალი",backgroundColor:"red",fontColor:"white"};L.innerHTML+="<p><strong><span class='innerhtml' style='font-size: 16px;'>ურბანული პოლიტიკური მრავალფეროვნება</span></strong></p><p><span class='innerhtml' style='padding: 5px; font-size: 18px; border-radius: 3px; color: white; background-color: "+E.backgroundColor+";'>"+C.toFixed(2)+"</span> ("+E.label+")</span></p>",null!==a&&null!==s&&null!==l&&null!==i&&null!==c&&null!==u&&null!==p&&null!==d&&null!==f&&null!==g&&null!==m&&null!==h&&null!==x&&null!==b&&(k.innerHTML+="<p style='display: flex; align-items: center; gap: 5px;'><img class='img-text' src='https://raw.githubusercontent.com/axis-Z/urbanyxv1/main/img/ქოცნება.png' alt='lelo' style='width: 25%; height: auto;'><span><span class='innerhtml' style='color:#666666; font-size: 15px;'>2024<span class='innerhtml' style='color:#969696; font-size: 15px;'> "+a+" ("+d+" %)</span><br></span></p><p style='display: flex; align-items: center; gap: 5px;'><img class='img-text' src='https://raw.githubusercontent.com/axis-Z/urbanyxv1/main/img/კოალიცია.png' alt='lelo' style='width: 25%; height: auto;'><span><span class='innerhtml' style='color:#666666; font-size: 15px;'>2024<span class='innerhtml' style='color:#969696; font-size: 15px;'> "+s+" ("+f+" %)</span><br></span></span></p><p style='display: flex; align-items: center; gap: 5px;'><img class='img-text' src='https://raw.githubusercontent.com/axis-Z/urbanyxv1/main/img/ყლელო.png' alt='lelo' style='width: 25%; height: auto;'><span><span class='innerhtml' style='color:#666666; font-size: 15px;'>2024<span class='innerhtml' style='color:#969696; font-size: 15px;'> "+i+" ("+m+" %)</span><br><span class='innerhtml' style='color:#666666; font-size: 15px;'>2025<span class='innerhtml' style='color:#969696; font-size: 15px;'> "+S+" ("+z+" %)</span><br><span style='color:"+Z+"; font-weight: bold;'> "+T+" "+Math.abs(F)+"%</span></span></span></p><p style='display: flex; align-items: center; gap: 5px;'><img class='img-text' src='https://raw.githubusercontent.com/axis-Z/urbanyxv1/main/img/თვალთხარია.png' alt='lelo' style='width: 25%; height: auto;'><span><span class='innerhtml' style='color:#666666; font-size: 15px;'>2024<span class='innerhtml' style='color:#969696; font-size: 15px;'> "+c+" ("+h+" %)</span><br><span class='innerhtml' style='color:#666666; font-size: 15px;'>2025<span class='innerhtml' style='color:#969696; font-size: 15px;'> "+y+" ("+M+" %)</span><br><span style='color:"+j+"; font-weight: bold;'> "+O+" "+Math.abs(B)+"%</span></span></span></p><p style='display: flex; align-items: center; gap: 5px;'><img class='img-text' src='https://raw.githubusercontent.com/axis-Z/urbanyxv1/main/img/ენმ.png' alt='lelo' style='width: 25%; height: auto;'><span><span class='innerhtml' style='color:#666666; font-size: 15px;'>2024<span class='innerhtml' style='color:#969696; font-size: 15px;'> "+l+" ("+g+" %)</span><br></span></span></p><p style='display: flex; align-items: center; gap: 5px;'><img class='img-text' src='https://raw.githubusercontent.com/axis-Z/urbanyxv1/main/img/გირჩი.png' alt='lelo' style='width: 25%; height: auto;'><span><span class='innerhtml' style='color:#666666; font-size: 15px;'>2024<span class='innerhtml' style='color:#969696; font-size: 15px;'> "+u+" ("+x+" %)</span><br></span></p><p style='display: flex; align-items: center; gap: 5px;'><img class='img-text' src='https://raw.githubusercontent.com/axis-Z/urbanyxv1/main/img/სხვა.png' alt='lelo' style='width: 25%; height: auto;'><span><span class='innerhtml' style='color:#666666; font-size: 15px;'>2024<span class='innerhtml' style='color:#969696; font-size: 15px;'> "+p+" ("+b+" %)</span><br></span></p>");var _=[{x:"ქალს ქალი ჰქვია",y:n,text:+n+" ("+r+"%)",fill:"#fdb462"},{x:"და კაცს კაცი",y:t,text:+t+" ("+o+"%)",fill:"#8dd3c7"}];new ej.charts.AccumulationChart({series:[{dataSource:_,xName:"x",yName:"y",pointColorMapping:"fill",type:"Pie",dataLabel:{visible:!0,position:"Inside",name:"text",font:{fontFamily:"JetBrains Mono",color:"black"}}}],legendSettings:{visible:!0,textStyle:{fontFamily:"JetBrains Mono",color:"#969696"}}}).appendTo("#genderPieChart")}})),fetch("https://raw.githubusercontent.com/axis-Z/urbanyxv1/main/data/relative_wealth_georgia.geojson").then((function(e){return e.json()})).then((function(t){var n={type:"FeatureCollection",features:t.features.filter((function(t){return turf.booleanPointInPolygon(turf.point(t.geometry.coordinates),e.features[0])}))};!function(e){function t(e){return e>=1?{backgroundColor:"green",fontColor:"#ffffff"}:e>=.75?{backgroundColor:"orange",fontColor:"#ffffff"}:{backgroundColor:"red",fontColor:"#ffffff"}}document.getElementById("legend").innerHTML+="<p><strong><span class='innerhtml' style='font-size: 16px;'>სიმდიდრის ინდექსი</strong></p><p><span class='innerhtml' style='padding: 5px; font-size: 18px; border-radius: 3px; color:"+t(e).fontColor+"; background-color:"+t(e).backgroundColor+";'>"+e.toFixed(2)+"</p>"}(n.features.reduce((function(e,t){return e+t.properties.RWI}),0)/n.features.length)})).catch((function(e){console.error("Error loading relative wealth index data:",e)}))}));var r,a=document.getElementById("data_source").value;"voters"===a&&(r="https://raw.githubusercontent.com/axis-Z/urbanyxv1/main/data/elections_2024.geojson"),r&&fetch(r).then((function(e){return e.json()})).then((function(o){var r={type:"FeatureCollection",features:o.features.filter((function(t){return turf.booleanPointInPolygon(turf.point(t.geometry.coordinates),e.features[0])}))};map.getSource("featuresWithinIsochrone").setData(r);var s={};r.features.forEach((function(e){var t=e.properties.amenity;s[t]||(s[t]=0),s[t]++}));var l=r.features.length,i=document.getElementById("legend-title"),c={walking:"ფეხით",cycling:"ველოსიპედით",driving:"ავტომობილით"}[t]||t;"voters"===a&&(i.innerHTML="<p><strong> <span class='innerhtml' style='color: yellow; background-color: black; padding: 2px 4px; border-radius: 3px;'>"+l+"</strong></span> საარჩევნო უბანი<strong> <span class='innerhtml' style='color: yellow; background-color: black; padding: 2px 4px; border-radius: 3px;'>"+n+"-წუთიან "+c+"</span></strong> სავალ მანძილზე</p>");var u=document.getElementById("legend");u.innerHTML="",u.style.display="block"})).catch((function(e){console.log("Error fetching data from selected data source:",e)}))})).catch((function(e){console.log("Error fetching isochrone data:",e)}))}dataSourceSelect.addEventListener("change",(function(){generateIsochrone(marker?marker.getLngLat():map.getCenter())})),map.on("click",(function(e){var t=e.lngLat;marker&&marker.remove(),marker=new mapboxgl.Marker({color:"#fb8072"}).setLngLat(t).addTo(map),generateIsochrone(t)})),map.on("load",(function(){map.addSource("isochrone",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),map.addLayer({id:"isochrone-layer",type:"fill",source:"isochrone",layout:{},paint:{"fill-color":"#b3cde3","fill-opacity":.15}}),map.addLayer({id:"outline",type:"line",source:"isochrone",layout:{},paint:{"line-color":"#fff7bc","line-width":1,"line-opacity":1}}),map.addSource("featuresWithinIsochrone",{type:"geojson",data:{type:"FeatureCollection",features:[]}})})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll('input[name="profile"]').forEach((function(e){e.addEventListener("change",(function(){var e=marker?marker.getLngLat():map.getCenter();document.querySelectorAll(".toggle").forEach((function(e){e.classList.remove("selected")})),this.nextElementSibling.classList.add("selected"),generateIsochrone(e)}))})),document.getElementById("contours_minutes").addEventListener("change",(function(){generateIsochrone(marker?marker.getLngLat():map.getCenter())}))})),map.on("click","featuresWithinIsochrone-layer",(function(e){var t=e.features[0];console.log("Clicked feature properties:",t.properties)}));